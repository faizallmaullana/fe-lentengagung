import{u as w,r as m,c as f,a as t,b as g,l as x,w as h,e as n,f as i,n as y,d as S,g as p,t as T,h as V,i as B,R as C,k as R,m as K,o as c,S as s}from"./index-SbiDxUwW.js";import{l as M}from"./login-bg-ByxHIqVW.js";const N={class:"bg-white w-full max-w-md rounded-xl shadow-2xl overflow-hidden border border-slate-100 relative z-10"},P={class:"p-6 text-center relative border-b border-slate-100"},A=["src"],I={class:"p-8"},U=["disabled"],j=["disabled"],q=["disabled"],z=["disabled"],D=["disabled"],L=["disabled"],E={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},G={class:"mt-6 text-center text-sm text-slate-600"},F={__name:"RegisterView",setup(H){const u=K(),b=w(),l=m(!1),a=m({nik:"",email:"",phone:"",password:"",confirmPassword:""}),k=async()=>{if(a.value.password!==a.value.confirmPassword){s.fire({icon:"warning",title:"Password Tidak Cocok",text:"Pastikan konfirmasi kata sandi sama dengan kata sandi.",confirmButtonColor:"#f59e0b"});return}if(String(a.value.nik).length!==16){s.fire({icon:"warning",title:"NIK Tidak Valid",text:"NIK harus terdiri dari 16 digit angka.",confirmButtonColor:"#f59e0b"});return}if(a.value.password.length<8){s.fire({icon:"warning",title:"Kata Sandi Terlalu Pendek",text:"Kata sandi minimal 8 karakter.",confirmButtonColor:"#f59e0b"});return}l.value=!0;try{const r={nik:String(a.value.nik),email:String(a.value.email),phone:String(a.value.phone),password:a.value.password};console.debug("[RegisterView] register payload:",r);const e=await b.register(r);if(console.debug("[RegisterView] register result:",e),e.success){console.warn(e);const o=e.data?.registration_token,d=e.approvalToken||e.approval_token||e.token||e.data?.approvalToken||e.data?.token;console.debug("[RegisterView] authToken:",o),console.debug("[RegisterView] approvalToken:",d),o&&(console.debug("[RegisterView] saving authToken to localStorage"),localStorage.setItem("authToken",o)),await s.fire({icon:"success",title:"Pendaftaran Berhasil!",text:"Akun Anda telah dibuat. Silakan cek email untuk kode verifikasi.",confirmButtonText:"Lanjut ke Verifikasi",confirmButtonColor:"#16a34a"}),d?(console.debug("[RegisterView] saving approvalToken to localStorage"),localStorage.setItem("approvalToken",d),u.push({path:"/approval",query:{token:d}})):(console.debug("[RegisterView] no approvalToken returned, redirecting to /approval"),u.push("/approval"))}else console.log(e),s.fire({icon:"error",title:"Gagal Mendaftar",text:e.message||"Terjadi kesalahan saat mendaftar."})}catch(r){s.fire({icon:"error",title:"System Error",text:r?.message||"Gagal menghubungi server."})}finally{l.value=!1}},v=()=>{u.push("/")};return(r,e)=>(c(),f("div",{class:"min-h-screen flex items-center justify-center px-4 bg-cover bg-center relative py-10",style:R({backgroundImage:`url(${g(M)})`})},[e[17]||(e[17]=t("div",{class:"absolute inset-0 bg-slate-900/50"},null,-1)),t("div",N,[t("div",P,[t("button",{onClick:v,class:"absolute left-6 top-6 text-slate-400 hover:text-slate-600 transition-colors",title:"Kembali ke Beranda"},[...e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1)])]),t("img",{src:g(x),alt:"Logo",class:"h-10 w-auto mx-auto mb-3"},null,8,A),e[6]||(e[6]=t("h2",{class:"text-xl font-bold text-slate-800"},"Pendaftaran Warga",-1)),e[7]||(e[7]=t("p",{class:"text-sm text-slate-500"},"Buat akun untuk mengajukan surat waris",-1))]),t("div",I,[t("form",{onSubmit:h(k,["prevent"]),class:"space-y-4"},[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"NIK (Nomor Induk Kependudukan)",-1)),n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.nik=o),type:"text",inputmode:"numeric",pattern:"\\d*",class:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500 transition-all disabled:bg-slate-100",placeholder:"16 digit NIK tertera di KTP",required:"",disabled:l.value},null,8,U),[[i,a.value.nik]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Alamat Email",-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.email=o),type:"email",class:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500 transition-all disabled:bg-slate-100",placeholder:"contoh@email.com",required:"",disabled:l.value},null,8,j),[[i,a.value.email]]),e[10]||(e[10]=t("p",{class:"text-xs text-slate-400 mt-1"},"Digunakan untuk notifikasi status & pemulihan akun.",-1))]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Nomor Telepon / WhatsApp",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.phone=o),type:"tel",class:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500 transition-all disabled:bg-slate-100",placeholder:"Contoh: 08123456789",required:"",disabled:l.value},null,8,q),[[i,a.value.phone]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Kata Sandi",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.password=o),type:"password",class:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500 transition-all disabled:bg-slate-100",placeholder:"Minimal 8 karakter",required:"",minlength:"8",disabled:l.value},null,8,z),[[i,a.value.password]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Ulangi Kata Sandi",-1)),n(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.confirmPassword=o),type:"password",class:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500 transition-all disabled:bg-slate-100",placeholder:"Masukkan ulang kata sandi",required:"",disabled:l.value},null,8,D),[[i,a.value.confirmPassword]])]),t("button",{type:"submit",disabled:l.value,class:y(["w-full py-3 px-4 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-md transition-all transform focus:ring-2 focus:ring-offset-1 focus:ring-green-500 mt-2 cursor-pointer flex justify-center items-center gap-2",l.value?"opacity-70 cursor-not-allowed hover:transform-none":"hover:-translate-y-0.5"])},[l.value?(c(),f("svg",E,[...e[14]||(e[14]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):S("",!0),p(" "+T(l.value?"Mendaftarkan Akun...":"Daftar Akun"),1)],10,L)],32),t("div",G,[e[16]||(e[16]=p(" Sudah punya akun? ",-1)),V(g(C),{to:"/login",class:"text-green-600 font-bold hover:underline"},{default:B(()=>[...e[15]||(e[15]=[p(" Masuk di sini ",-1)])]),_:1})])])])],4))}};export{F as default};
