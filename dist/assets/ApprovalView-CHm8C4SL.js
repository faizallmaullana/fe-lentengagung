import{_ as m,r as i,p as g,q as f,s as b,c as n,a as o,d as h,e as V,f as w,w as y,t as A,m as _,o as p,x}from"./index-SbiDxUwW.js";const T={class:"approval-page"},S={style:{display:"flex","flex-direction":"column",gap:"10px","align-items":"center"}},I={class:"actions"},M=["disabled"],q={key:0,class:"message"},B={__name:"ApprovalView",setup(E){const s=i(""),a=i(""),l=f(),u=_(),d=g(()=>!!(s.value||l.query?.token||localStorage.getItem("approvalToken")));b(()=>{try{console.debug("[ApprovalView] route.query:",l.query),console.debug("[ApprovalView] local approvalToken:",localStorage.getItem("approvalToken")),console.debug("[ApprovalView] local approvalEmail (ignored):",localStorage.getItem("approvalEmail"))}catch(t){console.debug("[ApprovalView] unable to read localStorage or route:",t)}});function c(){return s.value||l.query?.token||localStorage.getItem("approvalToken")||""}async function v(){const t=c();if(!t){console.error("[ApprovalView] token missing"),a.value="Token verifikasi tidak ditemukan. Mohon tempel token atau buka link verifikasi dari email Anda.";return}a.value="Mengirim tokenâ€¦";try{const e={token:t};console.debug("[ApprovalView] sending /auth/approve payload:",e);const r=localStorage.getItem("authToken")||"";console.debug("[ApprovalView] using app auth token from localStorage (present):",!!r);const k=await x("/auth/approve",e,{headers:{Authorization:r?`Bearer ${r}`:void 0}});console.debug("[ApprovalView] /auth/approve response:",k),a.value="Verifikasi berhasil. Anda akan diarahkan.",setTimeout(()=>u.push("/login"),900)}catch(e){console.error("[ApprovalView] /auth/approve error:",e),a.value=e?.message||"Gagal verifikasi. Coba lagi."}}return(t,e)=>(p(),n("div",T,[e[2]||(e[2]=o("h2",null,"Verifikasi Email",-1)),e[3]||(e[3]=o("p",null,"Masukkan kode 6 digit yang dikirim ke email Anda.",-1)),o("form",{onSubmit:y(v,["prevent"]),class:"form"},[o("div",S,[e[1]||(e[1]=o("label",{style:{"font-size":"14px",color:"#334155"}},"Token Verifikasi",-1)),V(o("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.value=r),placeholder:"Tempel token registrasi di sini",style:{width:"100%","max-width":"520px",padding:"10px",border:"1px solid #ddd","border-radius":"8px"}},null,512),[[w,s.value]]),o("div",I,[o("button",{type:"submit",disabled:!d.value},"Verifikasi",8,M)])])],32),a.value?(p(),n("p",q,A(a.value),1)):h("",!0)]))}},z=m(B,[["__scopeId","data-v-e4158a0d"]]);export{z as default};
